<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Alterar Informações do Cliente</title>
    <link rel="stylesheet" href="/css/styles.css">
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const addEnderecoButton = document.getElementById("addEndereco");
            const container = document.getElementById("enderecosContainer");

            // Verifica se há já 5 endereços e desabilita o botão
            if (container.children.length >= 5) {
                addEnderecoButton.disabled = true;
            }

            addEnderecoButton.addEventListener("click", function() {
                adicionarEndereco();
            });
        });

        function adicionarEndereco() {
            const container = document.getElementById("enderecosContainer");
            const index = container.children.length; // Obtém o índice atual

            // Verifica se já existem 5 endereços
            if (index >= 5) {
                alert("Você não pode adicionar mais de 5 endereços.");
                return;
            }

            const novoEndereco = `
                <div>
                    <input type="text" name="enderecosEntrega[${index}].logradouro" placeholder="Logradouro" required>
                    <input type="text" name="enderecosEntrega[${index}].numero" placeholder="Número" required>
                    <input type="text" name="enderecosEntrega[${index}].complemento" placeholder="Complemento">
                    <input type="text" name="enderecosEntrega[${index}].bairro" placeholder="Bairro" required>
                    <input type="text" name="enderecosEntrega[${index}].cidade" placeholder="Cidade" required>
                    <input type="text" name="enderecosEntrega[${index}].uf" placeholder="Estado" required>
                    <button type="button" onclick="removerEndereco(this)">Remover</button>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', novoEndereco);

            // Desabilita o botão se o limite de 5 for atingido
            if (container.children.length >= 5) {
                document.getElementById("addEndereco").disabled = true;
            }
        }

        function removerEndereco(button) {
            const container = document.getElementById("enderecosContainer");
            button.parentElement.remove();

            // Reativa o botão se houver menos de 5 endereços
            if (container.children.length < 5) {
                document.getElementById("addEndereco").disabled = false;
            }
        }
    </script>
</head>
<body>

<h2>Alterar Informações do Cliente</h2>

<div th:if="${mensagem}" class="alert">
    <p th:text="${mensagem}"></p>
</div>

<form th:action="@{/alterarCliente}" method="post" th:object="${cliente}">
    <div>
        <label for="nome">Nome:</label>
        <input type="text" id="nome" name="nome" th:value="*{nome}" required>
    </div>
    <div>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" th:value="*{email}" required>
    </div>
    <div>
        <label for="cpf">CPF:</label>
        <input type="text" id="cpf" name="cpf" th:value="*{cpf}" required>
    </div>
    <div>
        <label for="dataNascimento">Data de Nascimento:</label>
        <input type="date" id="dataNascimento" name="dataNascimento" th:value="*{dataNascimento}" required>
    </div>
    <div>
        <label for="genero">Gênero:</label>
        <select id="genero" name="genero" th:value="*{genero}">
            <option value="Masculino" th:selected="*{genero == 'Masculino'}">Masculino</option>
            <option value="Feminino" th:selected="*{genero == 'Feminino'}">Feminino</option>
            <option value="Outro" th:selected="*{genero == 'Outro'}">Outro</option>
        </select>
    </div>

    <h3>Alterar Senha</h3>
    <div>
        <label for="senha">Nova Senha:</label>
        <input type="password" id="senha" name="senha">
    </div>
    <div>
        <label for="confirmaSenha">Confirmar Nova Senha:</label>
        <input type="password" id="confirmaSenha" name="confirmaSenha">
    </div>

    <h3>Endereços de Entrega</h3>
    <div id="enderecosContainer">
        <div th:each="endereco, enderecoStat : ${cliente.enderecosEntrega}">
            <input type="text" name="enderecosEntrega[${enderecoStat.index}].logradouro" th:value="${endereco.logradouro}" placeholder="Logradouro" required>
            <input type="text" name="enderecosEntrega[${enderecoStat.index}].numero" th:value="${endereco.numero}" placeholder="Número" required>
            <input type="text" name="enderecosEntrega[${enderecoStat.index}].complemento" th:value="${endereco.complemento}" placeholder="Complemento">
            <input type="text" name="enderecosEntrega[${enderecoStat.index}].bairro" th:value="${endereco.bairro}" placeholder="Bairro" required>
            <input type="text" name="enderecosEntrega[${enderecoStat.index}].cidade" th:value="${endereco.cidade}" placeholder="Cidade" required>
            <input type="text" name="enderecosEntrega[${enderecoStat.index}].uf" th:value="${endereco.uf}" placeholder="Estado" required>
            <button type="button" onclick="removerEndereco(this)">Remover</button>
        </div>
    </div>
    <button type="button" id="addEndereco">Adicionar Endereço</button>

    <button type="submit">Salvar Alterações</button>
</form>

</body>
</html>
